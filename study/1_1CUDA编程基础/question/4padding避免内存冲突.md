# å¡«å……åˆ—é¿å…cudaå†…å­˜å†²çª
_Exported on 2025/12/23 at GMT+8 15:30:17 from Cursor (2.2.43)_

---

**User**

@study/1_1CUDAç¼–ç¨‹åŸºç¡€/3_å†…å­˜å±‚æ¬¡ç»“æ„/å†…å­˜å±‚æ¬¡ç»“æ„.md:318-328 ç”ŸåŠ¨å½¢è±¡è§£é‡Šä¸ºä»€ä¹ˆå¡«å……ä¸€åˆ—èƒ½é¿å…å†²çª

---

**Cursor**

æˆ‘æ¥ä¸ºä½ ç”ŸåŠ¨å½¢è±¡åœ°è§£é‡Šä¸ºä»€ä¹ˆå¡«å……ä¸€åˆ—èƒ½é¿å…Bankå†²çªã€‚

## ğŸ¦ é“¶è¡ŒæŸœå°ç±»æ¯”

æƒ³è±¡å…±äº«å†…å­˜æ˜¯ä¸€ä¸ªæœ‰ **32ä¸ªæŸœå°çª—å£** çš„é“¶è¡Œå¤§å…ï¼ˆ32ä¸ªBankï¼‰ã€‚

### æ²¡æœ‰Paddingçš„æƒ…å†µï¼šæ’é˜Ÿå™©æ¢¦ ğŸ˜±

```
__shared__ float sdata[32][32];
```

æŠŠè¿™ä¸ªäºŒç»´æ•°ç»„æƒ³è±¡æˆä¸€ä¸ª **32æ’åº§ä½çš„ç”µå½±é™¢**ï¼Œæ¯æ’32ä¸ªåº§ä½ï¼š

```
         åº§ä½0  åº§ä½1  åº§ä½2 ... åº§ä½31
ç¬¬0æ’:   Bank0  Bank1  Bank2 ... Bank31
ç¬¬1æ’:   Bank0  Bank1  Bank2 ... Bank31  â† åˆå›åˆ°Bank0ï¼
ç¬¬2æ’:   Bank0  Bank1  Bank2 ... Bank31
  ...
```

**é—®é¢˜æ¥äº†**ï¼šå½“32ä¸ªçº¿ç¨‹åŒæ—¶æƒ³è¯»å– **åŒä¸€åˆ—**ï¼ˆæ¯”å¦‚éƒ½è¯»ç¬¬0åˆ—ï¼‰ï¼š

```
çº¿ç¨‹0 æƒ³è¯» sdata[0][0] â†’ å»æŸœå°0
çº¿ç¨‹1 æƒ³è¯» sdata[1][0] â†’ å»æŸœå°0  â† æ’è½¦äº†ï¼
çº¿ç¨‹2 æƒ³è¯» sdata[2][0] â†’ å»æŸœå°0  â† åˆæ’è½¦ï¼
...
çº¿ç¨‹31 æƒ³è¯» sdata[31][0] â†’ å»æŸœå°0
```

**32ä¸ªäººæŒ¤åœ¨åŒä¸€ä¸ªæŸœå°æ’é˜Ÿï¼** è¿™å°±æ˜¯ **32è·¯Bankå†²çª**ï¼Œéœ€è¦ä¸²è¡Œå¤„ç†32æ¬¡ï¼

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿæ•°å­¦åŸç† ğŸ”¢

```
æ¯è¡Œ32ä¸ªfloat Ã— 4å­—èŠ‚ = 128å­—èŠ‚
128å­—èŠ‚ Ã· 4å­—èŠ‚/Bank = 32ä¸ªBank
```

**æ¯è¡Œæ­£å¥½å æ»¡32ä¸ªBank**ï¼Œæ‰€ä»¥ä¸‹ä¸€è¡Œåˆä»Bank0å¼€å§‹ï¼Œå½¢æˆ"å®Œç¾å¯¹é½"çš„å†²çªï¼

---

### åŠ äº†Paddingï¼šå®Œç¾é”™å¼€ âœ¨

```
__shared__ float sdata[32][33];  // å¤šåŠ 1åˆ—
```

ç°åœ¨ç”µå½±é™¢æ¯æ’æœ‰ **33ä¸ªåº§ä½**ï¼š

```
         åº§ä½0  åº§ä½1  åº§ä½2 ... åº§ä½32(dummy)
ç¬¬0æ’:   Bank0  Bank1  Bank2 ... Bank0  
ç¬¬1æ’:   Bank1  Bank2  Bank3 ... Bank1   â† èµ·ç‚¹é”™å¼€äº†1æ ¼ï¼
ç¬¬2æ’:   Bank2  Bank3  Bank4 ... Bank2   â† åˆé”™å¼€1æ ¼ï¼
  ...
```

**å†çœ‹åŒä¸€åˆ—è®¿é—®**ï¼š

```
çº¿ç¨‹0 æƒ³è¯» sdata[0][0] â†’ å»æŸœå°0
çº¿ç¨‹1 æƒ³è¯» sdata[1][0] â†’ å»æŸœå°1  âœ“ ä¸åŒæŸœå°ï¼
çº¿ç¨‹2 æƒ³è¯» sdata[2][0] â†’ å»æŸœå°2  âœ“ ä¸åŒæŸœå°ï¼
...
çº¿ç¨‹31 æƒ³è¯» sdata[31][0] â†’ å»æŸœå°31 âœ“
```

**æ¯ä¸ªäººå»ä¸åŒæŸœå°ï¼Œå¹¶è¡ŒæœåŠ¡ï¼** ğŸ‰

### æ•°å­¦åŸç† ğŸ”¢

```
æ¯è¡Œ33ä¸ªfloat Ã— 4å­—èŠ‚ = 132å­—èŠ‚
132 mod 128 = 4å­—èŠ‚ = 1ä¸ªBankçš„åç§»
```

**æ¯è¡Œèµ·ç‚¹å¾€åé”™1ä¸ªBank**ï¼Œ33è¡Œåæ‰ä¼šå¾ªç¯ä¸€åœˆã€‚æ‰€ä»¥åŒä¸€warpå†…32ä¸ªçº¿ç¨‹è®¿é—®åŒä¸€åˆ—æ—¶ï¼Œå„è‡ªè½åœ¨ä¸åŒBankï¼

---

## ğŸ¨ å¯è§†åŒ–å¯¹æ¯”

```
âŒ æ— Padding [32][32]            âœ… æœ‰Padding [32][33]
   
   åˆ—0 åˆ—1 åˆ—2 ...                  åˆ—0 åˆ—1 åˆ—2 ...
   â†“   â†“   â†“                        â†“   â†“   â†“
è¡Œ0: B0  B1  B2  ...  B31         è¡Œ0: B0  B1  B2  ... B32(â†’B0)
è¡Œ1: B0  B1  B2  ...  B31         è¡Œ1: B1  B2  B3  ... B0
è¡Œ2: B0  B1  B2  ...  B31         è¡Œ2: B2  B3  B4  ... B1
 â†“   â†“                             â†“   â†“
åŒåˆ—=åŒBank=å†²çªï¼               åŒåˆ—=ä¸åŒBank=æ— å†²çªï¼
```

## ğŸ’¡ æ ¸å¿ƒæ€æƒ³

**Paddingå°±åƒåœ¨ç”µå½±é™¢æ¯æ’å¤šæ”¾ä¸€ä¸ªç©ºåº§ä½**ï¼Œè®©æ¯ä¸€æ’çš„èµ·ç‚¹"é”™ä½"ï¼Œè¿™æ ·åŒä¸€åˆ—çš„åº§ä½å°±ä¸ä¼šéƒ½è½åœ¨åŒä¸€ä¸ªæŸœå°çª—å£å‰æ’é˜Ÿäº†ï¼

ä»£ä»·åªæ˜¯æµªè´¹äº†32ä¸ªfloatçš„ç©ºé—´ï¼ˆçº¦128å­—èŠ‚ï¼‰ï¼Œä½†æ¢æ¥äº† **32å€çš„è®¿é—®é€Ÿåº¦æå‡**ï¼

```plaintext
__shared__ float sdata[32][32];
```

```plaintext
         åº§ä½0  åº§ä½1  åº§ä½2 ... åº§ä½31
ç¬¬0æ’:   Bank0  Bank1  Bank2 ... Bank31
ç¬¬1æ’:   Bank0  Bank1  Bank2 ... Bank31  â† åˆå›åˆ°Bank0ï¼
ç¬¬2æ’:   Bank0  Bank1  Bank2 ... Bank31
  ...
```

```plaintext
çº¿ç¨‹0 æƒ³è¯» sdata[0][0] â†’ å»æŸœå°0
çº¿ç¨‹1 æƒ³è¯» sdata[1][0] â†’ å»æŸœå°0  â† æ’è½¦äº†ï¼
çº¿ç¨‹2 æƒ³è¯» sdata[2][0] â†’ å»æŸœå°0  â† åˆæ’è½¦ï¼
...
çº¿ç¨‹31 æƒ³è¯» sdata[31][0] â†’ å»æŸœå°0
```

```plaintext
æ¯è¡Œ32ä¸ªfloat Ã— 4å­—èŠ‚ = 128å­—èŠ‚
128å­—èŠ‚ Ã· 4å­—èŠ‚/Bank = 32ä¸ªBank
```

```plaintext
__shared__ float sdata[32][33];  // å¤šåŠ 1åˆ—
```

```plaintext
         åº§ä½0  åº§ä½1  åº§ä½2 ... åº§ä½32(dummy)
ç¬¬0æ’:   Bank0  Bank1  Bank2 ... Bank0  
ç¬¬1æ’:   Bank1  Bank2  Bank3 ... Bank1   â† èµ·ç‚¹é”™å¼€äº†1æ ¼ï¼
ç¬¬2æ’:   Bank2  Bank3  Bank4 ... Bank2   â† åˆé”™å¼€1æ ¼ï¼
  ...
```

```plaintext
çº¿ç¨‹0 æƒ³è¯» sdata[0][0] â†’ å»æŸœå°0
çº¿ç¨‹1 æƒ³è¯» sdata[1][0] â†’ å»æŸœå°1  âœ“ ä¸åŒæŸœå°ï¼
çº¿ç¨‹2 æƒ³è¯» sdata[2][0] â†’ å»æŸœå°2  âœ“ ä¸åŒæŸœå°ï¼
...
çº¿ç¨‹31 æƒ³è¯» sdata[31][0] â†’ å»æŸœå°31 âœ“
```

```plaintext
æ¯è¡Œ33ä¸ªfloat Ã— 4å­—èŠ‚ = 132å­—èŠ‚
132 mod 128 = 4å­—èŠ‚ = 1ä¸ªBankçš„åç§»
```

```plaintext
âŒ æ— Padding [32][32]            âœ… æœ‰Padding [32][33]
   
   åˆ—0 åˆ—1 åˆ—2 ...                  åˆ—0 åˆ—1 åˆ—2 ...
   â†“   â†“   â†“                        â†“   â†“   â†“
è¡Œ0: B0  B1  B2  ...  B31         è¡Œ0: B0  B1  B2  ... B32(â†’B0)
è¡Œ1: B0  B1  B2  ...  B31         è¡Œ1: B1  B2  B3  ... B0
è¡Œ2: B0  B1  B2  ...  B31         è¡Œ2: B2  B3  B4  ... B1
 â†“   â†“                             â†“   â†“
åŒåˆ—=åŒBank=å†²çªï¼               åŒåˆ—=ä¸åŒBank=æ— å†²çªï¼
```

